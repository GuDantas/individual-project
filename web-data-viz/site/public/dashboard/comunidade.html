<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comunidade</title>
    <link rel="stylesheet" href="../Rethink/CSS/style.css">
    <link rel="stylesheet" href="../Rethink/flexboxgrid-6.3.1/css/flexboxgrid.min.css">
    <link rel="stylesheet" href="../Rethink/CSS/comunidade.css">
</head>

<body onload="atualizar(), verificarLogin()">
    <div class=" main container-fluid">
        <div class="row justify-content-sm-center">
            <div class="Header col-md-12">
                <div class="interaction col-md-4">
                    <a class="logoLink" href="../index.html">
                        <h1>Rethink the Engines</h1>
                    </a>
                    <img class="logotipo" src="../Rethink/images/logo.png" alt="logotipo">
                </div>
                <div class="menu col-md-8">
                    <a class="option" href="">Realidade sobre motores a combustão & elétricos</a>
                    <a class="option" href="realidade.html">Compare você mesmo</a>
                    <a class="option" href="">Comunidade</a>
                </div>
            </div>
            <!--Final Header-->

            <div class="newComment col-md-8">
                <h2 class="guideText">Assunto</h2>
                <input class="assuntoInpt" id="inptAssunto" type="text">
                <h2 class="guideText">Comentário</h2>
                <input class="comentarioInpt" id="inptComentario"><br>
                <button id="btnPublicar" class="publish option" onclick="publicar()">Publicar</button>
                <a id="hiddenMsg" class="hiddenMsg" href="../login.html">É necessário fazer login para publicar</a>
            </div>
            <div class="comunityContainer col-md-8" id="comunityContainer">
                <div id="comment" class="comment">
                    <div id="basicInfo" class="basicInfo">
                        <h3 id="about" class="about">Assunto</h3>
                        <b id="user" class="user">Usuario</b>
                    </div>
                    <p id="descricao" class="descricao">Emerson Olhos quebrou o recorde de velocidade em um uno?</p>
                    <div id="commentOptions" class="commentOptions">
                        <button id="excluir" class="option publish">Excluir</button>
                        <button id="responder" class="option publish">Responder</button>
                    </div>
                </div>
            </div>
            <!--Inicio Footer-->
            <div class="footer col-md-12 col-lg-12">
                <div class="logoHome col-md-2">
                    <a href="../index.html">
                        <img class="homeBtn" src="../Rethink/images/logo.png" alt="Logotipo / Botão home">
                    </a>
                    <a class="logoLink" href="../index.html">
                        <h3>Rethink The Engines</h3>
                    </a>
                </div>
                <div class="footerColumn col-md-2">
                    <h4>Contatos:</h4>
                    <a href="">Sobre nós</a>
                    <a href="">Sugestões</a>
                </div>
                <div class="footerColumn col-md-2">
                    <h4>Nosso Contexto:</h4>
                    <a href="realidade.html">Compare Você mesmo</a>
                    <a href="">Nossa Causa</a>
                </div>
                <div class="footerColumn col-md-2">
                    <h4>Atalhos:</h4>
                    <a href="../index.html">Página Inicial</a>
                    <a href="">Comunidade</a>
                </div>
                <div class="footerColumn col-md-2">
                    <h4>Autenticação:</h4>
                    <a href="../login.html">Login</a>
                    <a href="../cadastro.html">Cadastro</a>
                </div>
            </div>
            <b class="copyright">Copyright © 2023 - Todos os direitos reservados para Gustavo Enrico</b>
        </div>
    </div>
</body>

</html>
<script>
    var idUsuario = sessionStorage.ID_USUARIO;
    function publicar() {
        var assuntoVar = inptAssunto.value;
        var descricaoVar = inptComentario.value;

        fetch(`/avisos/publicar/${idUsuario}`, {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                assuntoServer: assuntoVar,
                descricaoServer: descricaoVar,
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);
            window.alert("Post realizado com sucesso pelo usuario de ID: " + idUsuario + "!");
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }
    function atualizar() {
        fetch("/avisos/listar").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                
                }
                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    var divContainer = document.getElementById("comunityContainer")
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                        var divComment = document.createElement("div");
                        var divBasicInfo = document.createElement("div");
                        var pDescricao = document.createElement("p");
                        var h3About = document.createElement("h3");
                        var bUsuario = document.createElement("b");
                        var divCommentOptions = document.createElement("div");
                        var btnEditar = document.createElement("button");
                        var btnExcluir = document.createElement("button");
                        
                        bUsuario.innerHTML = `Usuario: ${publicacao.nomeUsuario}`;
                        h3About.innerHTML = `Assunto: ${publicacao.assunto}`;
                        pDescricao.innerHTML = `${publicacao.descricao}`;
                        btnEditar.innerHTML =`Editar`;
                        btnExcluir.innerHTML =`Excluir`;

                        divComment.className = "comment";
                        bUsuario.className = "user";
                        h3About.className = "about";
                        pDescricao.className = "descricao";
                        divBasicInfo.className = "basicInfo";
                        divCommentOptions.className = "commentOptions";
                        btnEditar.className = "option publish";
                        btnExcluir.className = "option publish";

                        btnExcluir.setAttribute("onclick", `excluir(${publicacao.nomeUsuario})`);
                        btnEditar.setAttribute("onclick", `editar(${publicacao.nomeUsuario})`);

                        divComment.appendChild(divBasicInfo);
                        divComment.appendChild(pDescricao);
                        divComment.appendChild(divCommentOptions);
                        divBasicInfo.appendChild(bUsuario);
                        divBasicInfo.appendChild(h3About);
                        divCommentOptions.appendChild(btnEditar);
                        divCommentOptions.appendChild(btnExcluir);

                        divContainer.appendChild(divComment)
                        
                    }
                
                });
            } else {
                throw("Houve um erro")
            }
        }).catch(function (resposta){
            console.error(resposta);
        });
    }

function verificarLogin(){
    if(idUsuario == null){
        btnPublicar.style.display = "none"
        hiddenMsg.style.display = "block"
    }
    else{
        btnPublicar.style.display = "block"
        hiddenMsg.style.display = "none"
    }
}
</script>